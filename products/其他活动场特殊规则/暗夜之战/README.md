# 暗夜之战模式

活动场对应 `mode_id` 是 45, 关键词是 `reveal_discard`

## 规则说明

- 打牌时, 可以选择支付1000点"暗牌", 将这张牌盖牌打出
    - 暗牌不会被吃, 碰, 杠和荣和, 不会触发自己与其他玩家的振听
    - 玩家点数不足1000点时, 不能选择暗牌操作
    - 玩家点数不足2000点时, 不能选择暗牌立直操作
- 其他玩家暗牌时, 可以选择支付2000点"开牌", 将这张牌翻开
    - 除暗牌的玩家外, 其他三名玩家同时选择是否开牌
    - 多人同时开牌时, 由暗牌玩家逆时针靠前的玩家支付点数
    - 开牌成功后, 暗牌不成立, 对所有人公开, 可以被吃, 碰, 杠和荣和
    - 玩家点数不足2000点时, 不能选择开牌操作
- 有玩家开牌时, 暗牌玩家可以选择支付4000点将这张牌"锁定"为盖牌状态
    - 锁定状态的牌永远不公开, 其他玩家不能对锁定牌进行吃, 碰, 杠和荣和操作
    - 玩家点数不足4000点时, 不能选择锁定操作
- 暗牌, 开牌, 锁定操作支付的点棒为公共供托, 下一次和牌的玩家拿走所有供托
    - 出现一炮多响的情况, 放铳者逆时针靠前的玩家拿走所有供托(含立直棒和本场供托)
    - 对局结束时, 场上所有无人认领的供托归于一位
    - 暗牌打出的牌不影响流局满贯, 即只根据非暗牌部分判定

## 函数特殊说明

### 切牌(暗夜之战)

`qiepai(seat, tile, is_liqi, f_moqie, anpai)`

与段位场相比多了个参数 `anpai`, 如果 `anpai` 的值是字符串 `'anpai'` 时, 在暗夜之战切牌会暗牌, 否则不会暗牌

例子: `qiepai(0, '7z', true, 'anpai');`

### 开牌并成功(暗夜之战)

`kaipai(seat)`

有人暗牌之后, 调用该函数可以使得 `seat` 号玩家开牌, 并且暗牌家没有锁定, 开牌成功

例子: `kaipai(1);`

### 开牌后锁定(暗夜之战)

`kaipaiLock(seat)`

有人暗牌之后, 调用该函数可以使得 `seat` 号玩家开牌, 紧跟着暗牌家锁定, 开牌失败

例子: `kaipaiLock(2);`

## 示例牌谱

- [demo01](demo01.js)
- [四家流满](四家流满.js)
