# majsoul-replay-editor 的 Copilot 使用说明

本文件说明仓库布局、开发约定、常见工作流以及给贡献者与自动化助手的要点。目标是简洁且可执行，帮助贡献者（以及类似 Copilot 的助手）安全且一致地修改代码。

---

## 1. 项目用途与概要

- 目的：为 Majsoul（雀魂）网页版客户端提供注入脚本与示例牌谱文件。作者通过在浏览器控制台（DevTools）中粘贴 JS 实现自定义牌谱回放。
- 核心脚本：
  - `main.js` / `main.ts` —— 在浏览器端运行的主入口脚本。
  - `add_function.js` —— 可选扩展与自制模式（提供官方客户端没有的功能）。
  - `code.js` —— 反混淆后的客户端源码，仅供参考（体积很大，避免编辑）。
- 示例与自制牌谱：
  - `examples/` —— 小规模示例脚本与 demo。
  - `products/` —— 大量整理好的牌谱、分类与自制模式。
- 文档：`doc/` 包含作者指南；部分文件已有英文译本，位于 `doc/en/`。

---

## 2. 仓库对贡献者/助手的基本期望

- 无需构建/测试系统即可运行或验证牌谱：脚本直接在浏览器控制台对 Majsoul 客户端生效。
- 添加代码或示例时：
  - 优先在 `products/` 下新增文件（遵循现有命名与目录结构）。
  - 尽量保持 `main.js` 与 `add_function.js` 的稳定性——必要时扩展，但避免破坏已有回放脚本依赖的公共接口。
  - 适当添加 JSDoc 注释；示例应小而聚焦，便于复现。
- 避免嵌入密钥或外部凭据。本仓库不运行需要网络调用的 CI。

---

## 3. 仓库结构（简要）

- `main.js`, `main.ts`, `main.d.ts` —— 核心运行代码与类型定义
- `add_function.js` —— 扩展与自制模式
- `examples/` —— 示例脚本（1.js..4.js, demo.js）
- `products/` —— 各类牌谱目录：`3P/`, `4P/`, `自制模式/`, `国标麻将/`, `作弊牌型/` 等
- `doc/` —— 权威文档（中文）。部分英文翻译在 `doc/en/` 下。
- `doc/pic/` —— 文档使用的图片
- `.github/` —— 仓库相关的辅助文件（包含本文件）

---

## 4. 本地快速工作流（编写与测试自制牌谱）

1. 使用测试号/小号登录 Majsoul 网页客户端。
2. 在浏览器打开 Majsoul 页面，按 F12 打开 DevTools → Console。
3. 将整个 `main.js` 的内容复制粘贴到控制台并回车执行。
4. 再将你的回放脚本（例如 `examples/` 或 `products/` 下的文件）复制粘贴到控制台并执行。
   - 若控制台阻止粘贴，先输入 `allow pasting`（或中文 `允许粘贴`）然后再粘贴。
5. 在网站上打开任意一个回放，注入脚本会替换为你制作的自定义牌谱并展示。

注意：
- 请务必使用测试账号——第三方脚本可能导致封号。
- 若回放导致页面报错或卡死，刷新页面清除状态后重试。

---

## 5. 关键的编写文件与函数

- 常用变量：`player_datas`, `begin_tiles`, `player_tiles`, `all_data`（详见 `doc/`）。
- 编写回放流程常用函数（参见 `doc/3_对局操作相关函数.md`）：`mopai`, `qiepai`, `mingpai`, `zimingpai`, `hupai`, `huangpai`, `liuju`, `setRound`, `setPaishan`, `randomPaishan`, `setDiscardTiles`, `setDealTiles`, `roundBegin`, `demoGame`。
- 活动场相关行为请参阅 `doc/4_对局操作相关函数（活动场）.md`。

---

## 6. 文档与翻译状态

- 正式文档位于 `doc/`（中文）。目前已翻译为英文并放在 `doc/en/`, 文件包括：
  - `doc/1_编辑游戏信息.md`
  - `doc/2_编辑每个小局.md`
  - `doc/3_对局操作相关函数.md`
  - `doc/4_对局操作相关函数（活动场）.md`
  - `doc/5_部分进阶功能.md`
  - `doc/6_推荐使用变量函数汇总.md`
  - `doc/7_其他杂项信息.md`
- 若你修改了行为或新增功能，请同时更新对应的 `doc/`，若已翻译也同步更新 `doc/en/`。

---

## 7. 约定与最佳实践

- 示例文件要简洁且可复现。建议每个示例文件顶部包含 `clearProject()` 以防数据叠加。
- 尽量避免修改 `main.js` 的公共接口；如必须修改，请补充清晰的 TSDoc/JSDoc 并更新 `main.d.ts` 与 `README`。
- 在 `products/` 下新增模式时，将其放在合适的子目录（例如 `products/自制模式/` 或 `products/4P/修罗之战相关/`）。
- 使用描述性文件名，并在复杂模式目录中附上简短 `README.md`。

---

## 8. 安全与法律说明

- 本仓库为第三方脚本，会与闭源的网页客户端交互。使用风险由使用者承担；维护者对使用脚本导致的封号或其他后果不承担责任。
- 许可证：Apache-2.0（见 `LICENSE`）。

---

## 9. 测试与校验

- 本项目没有针对浏览器注入的自动运行时测试套件，验证主要依赖人工：
  - 在测试号会话中加载 `main.js` 与你的回放脚本，并观察控制台是否有错误。
  - 在控制台检查 `all_data` 和 `player_tiles` 是否符合预期。
- 若修改 TypeScript 源（`main.ts`），请在本地构建以生成或更新 `main.js`。修改 TS 文件时请保持 `main.js` 与 `main.d.ts` 的一致性。

---

## 10. 贡献者与联系方式

- 原作者：`GrandDawn`。
- 当前维护者：`Fat-pig-Cui`。
- 若有 bug 或功能请求，请在 GitHub 提交 issue，或联系维护者（见仓库 `README.md`）。

---

如需将本说明调整为其他语言或格式，或对内容有疑问，告诉我即可，我会继续更新。
